<head>
    <!-- Customize the title! -->
    <title>Illusion Game</title>
    <!-- jsPsych Scripts -->
    <script src="https://unpkg.com/jspsych@7.2.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-browser-check"></script>
    <!-- Other modules -->
    <script src="https://realitybending.github.io/JSmisc/misc/utils.js"></script>
    <!-- Load stimuli -->
    <script src="stimuli/stimuli.js"></script>
    <script src="experiment.js"></script>
    <script src="population_scores.js"></script>
    <!-- CSS -->
    <link href="https://unpkg.com/jspsych@7.2.3/css/jspsych.css" rel="stylesheet" type="text/css" />
    <style>
        /* set canvas to be full screen */
        .jspsych-content {
                max-width: 100%;
            }

        /*Hide scrollbar while keeping it functional */
        body {
            overflow-y: scroll;
            overflow-x: flow;
        }

        Body::-webkit-scrollbar {
            display: none
        }
    </style>
</head>

<body></body>



<script>


    /* ----------------- Initialize experiment ----------------- */
    var timeline = []

    var jsPsych = initJsPsych({
        show_progress_bar: true,
        message_progress_bar: "Completion",
        // exclusions: { min_width: 800, min_height: 600 }, /* exclude browsers that are not at least 800x600 pix */
        //  on_interaction_data_update: function (data) {console.log(JSON.stringify(data))}, /* record browser interactions */
        on_finish: function () {
            jsPsych.data.displayData("json")
            jsPsych.data
                .get()
                .localSave(
                    "json",
                    `${
                        jsPsych.data.get().values()[0]["participant_id"]
                    }_IllusionGame.json`
                )
        },
    })

    // Fullscreen mode
    timeline.push({
        type: jsPsychFullscreen,
        fullscreen_mode: true,
        delay_after: 0,
    })

    // Retrieve and save browser info
    var browser_check = {
        type: jsPsychBrowserCheck,
        data: {
            screen: "browser_info",
        },
        on_finish: function () {
            data = jsPsych.data.get().filter({ screen: "browser_info" }).values()[0]
            jsPsych.data.addProperties({
                ["screen_height"]: data["height"],
                ["screen_width"]: data["width"],
            })
            for (var key in data) {
                if (
                    [
                        "vsync_rate",
                        "os",
                        "mobile",
                        "browser",
                        "browser_version",
                    ].includes(key)
                ) {
                    jsPsych.data.addProperties({
                        [key]: data[key],
                    })
                }
            }
            jsPsych.data.addProperties()
        },
    }
    timeline.push(browser_check)

    /* ----------------- Experiment  ----------------- */

    // Participant information
    var participant_info = {
        type: jsPsychSurveyText,
        questions: [
            {
                prompt: "Enter the participant's ID:",
                placeholder: "S00",
                name: "Participant_ID",
            },
        ],
        data: {
            screen: "participant_info",
            version: "1.0",
            date: new Date().toLocaleDateString("fr-FR"),
            time: new Date().toLocaleTimeString("fr-FR"),
        },
        on_finish: function () {
            jsPsych.data.addProperties({
                participant_id: jsPsych.data.get().last().values()[0]["response"][
                    "Participant_ID"
                ],
            })
        },
    }
    timeline.push(participant_info)

    // General Instructions
    var general_instructions = {
        type: jsPsychHtmlButtonResponse,
        choices: ["Let's play!"],
        stimulus:
            "<p><b>The Illusion Game</b></p>" +
            "<p>In this reaction-time game, you will need to be <b>as fast as possible</b> and make correct responses by resisting different visual illusions.</p>" +
            "<p>We will show you examples of each illusion before each block.</p>" +
            "<p>Remember, your goal is to be as <b>fast</b> and <b>accurate</b> as possible. Good luck!</p>",
        data: { screen: "general_instructions" },
    }
    timeline.push(general_instructions)

    // Set experiment variables
    var trial_number = 1 // trial indexing variable starts at 1 for convenience
    var block_number = 1 // block indexing variable

    /* ============================================================== */
    /* ---------------------- DELBOEUF ILLUSION --------------------- */
    /* ============================================================== */
    var timeline_delboeuf = []

    // Set stimuli (var stimuli is loaded in stimuli/stimuli.js)
    var stimuli_delboeuf = stimuli.filter(
        (stimuli) => stimuli.Illusion_Type === "Delboeuf"
    )

    // Preload images
    timeline_delboeuf.push({
        type: jsPsychPreload,
        trials: stimuli_delboeuf,
    })

    // Instructions
    var instructions_delboeuf = {
        type: jsPsychHtmlKeyboardResponse,
        on_start: function () {
            ;(document.body.style.cursor = "none"),
                (document.querySelector(
                    "#jspsych-progressbar-container"
                ).style.display = "none")
        },
        choices: ["enter"],
        stimulus: function () {
            return (
                "<p><b>Part " +
                block_number +
                "</b></p>" +
                "<p>In this part, two red circles will appear side by side on the screen.</p>" +
                "<p>Your task is to select which <b>red circle is bigger</b> in size as fast as you can, without making errors.</p>" +
                "<p>Don't get distracted by the black outlines around the red circles!</p>" +
                "<p>Press <b>the LEFT or the RIGHT arrow</b> to indicate where is the biggest <b>red circle.</b></p>" +
                "<div style='float: center'><img src='utils/stimuli_demo/Delboeuf_Demo.png' height='300'></img>" +
                "<p><img src='utils/answer/answer_leftright_keyboard.PNG' height='150'></img></p>" +
                "<p class='small'>In this example, the correct answer is the <b>LEFT arrow</b>.</p></div>" +
                "<p>Are you ready? <b>Press ENTER to start</b></p>"
            )
        },
        post_trial_gap: 500,
    }
    timeline_delboeuf.push(instructions_delboeuf)

    // Define trial
    var trial_delboeuf = create_trial("Delboeuf", type = "leftright")

    // Create Trials timeline
    timeline_delboeuf.push({
        timeline: [fixation, trial_delboeuf],
        timeline_variables: stimuli_delboeuf,
        randomize_order: true,
        repetitions: 1,
    })

    // Debriefing Information
    timeline_delboeuf.push(create_debrief(illusion_name = "Delboeuf"))

    // timeline.push({ timeline: timeline_delboeuf })

    /* ================================================================ */
    /* ---------------------- MULLERLYER ILLUSION --------------------- */
    /* ================================================================ */
    var timeline_mullerlyer = []

    // Set stimuli (var stimuli is loaded in stimuli/stimuli.js)
    var stimuli_mullerlyer = stimuli.filter(
        (stimuli) => stimuli.Illusion_Type === "MullerLyer"
    )

    // Preload images
    timeline_mullerlyer.push({
        type: jsPsychPreload,
        trials: stimuli_mullerlyer,
    })

    // Instructions
    var instructions_mullerlyer = {
        type: jsPsychHtmlKeyboardResponse,
        on_start: function () {
            ;(document.body.style.cursor = "none"),
                (document.querySelector(
                    "#jspsych-progressbar-container"
                ).style.display = "none")
        },
        choices: ["enter"],
        stimulus: function () {
            return (
                "<p><b>Part " +
                block_number +
                "</b></p>" +
                "<p>In this part, two horizontal red lines will appear one above the other.</p>" +
                "<p>Your task is to select which <b>line is longer</b> in size as fast as you can, without making errors.</p>" +
                "<p>Don't get distracted by the surrounding black arrows at the end of the red lines!</p>" +
                "<p>Press <b>the UP or the DOWN arrow</b> to indicate where is the longest <b>red line.</b></p>" +
                "<div style='float: center'><img src='utils/stimuli_demo/MullerLyer_Demo.png' height='300'></img>" +
                "<p><img src='utils/answer/answer_updown_keyboard.PNG' height='150'></img></p>" +
                "<p class='small'>In this example, the correct answer is the <b>UP arrow</b>.</p></div>" +
                "<p>Are you ready? <b>Press ENTER to start</b></p>"
            )
        },
        post_trial_gap: 500,
    }
    timeline_mullerlyer.push(instructions_mullerlyer)

    // Define trial
    var trial_mullerlyer = create_trial("MullerLyer", type = "updown")

    // Create Trials timeline
    timeline_mullerlyer.push({
        timeline: [fixation, trial_mullerlyer],
        timeline_variables: stimuli_mullerlyer,
        randomize_order: true,
        repetitions: 1,
    })

    // Debriefing Information
    timeline_mullerlyer.push(create_debrief(illusion_name = "MullerLyer"))

    // timeline.push({ timeline: timeline_mullerlyer })

    /* ================================================================ */
    /* --------------------- EBBINGHAUS ILLUSION ---------------------- */
    /* ================================================================ */
    var timeline_ebbinghaus = []

    // Set stimuli (var stimuli is loaded in stimuli/stimuli.js)
    var stimuli_ebbinghaus = stimuli.filter(
        (stimuli) => stimuli.Illusion_Type === "Ebbinghaus"
    )

    // Preload images
    timeline_ebbinghaus.push({
        type: jsPsychPreload,
        trials: stimuli_ebbinghaus,
    })

    // Instructions
    var instructions_ebbinghaus = {
        type: jsPsychHtmlKeyboardResponse,
        on_start: function () {
            ;(document.body.style.cursor = "none"),
                (document.querySelector(
                    "#jspsych-progressbar-container"
                ).style.display = "none")
        },
        choices: ["enter"],
        stimulus: function () {
            return (
                "<p><b>Part " +
                block_number +
                "</b></p>" +
                "<p>In this part, two red circles will appear side by side on the screen.</p>" +
                "<p>Your task is to select which <b>red circle is bigger</b> in size as fast as you can, without making errors.</p>" +
                "<p>Don't get distracted by the surrounding black circles around the red circles!</p>" +
                "<p>Press <b>the LEFT or the RIGHT arrow</b> to indicate where is the biggest <b>red circle.</b></p>" +
                "<div style='float: center'><img src='utils/stimuli_demo/Ebbinghaus_Demo.png' height='300'></img>" +
                "<p><img src='utils/answer/answer_leftright_keyboard.PNG' height='150'></img></p>" +
                "<p class='small'>In this example, the correct answer is the <b>LEFT arrow</b>.</p></div>" +
                "<p>Are you ready? <b>Press ENTER to start</b></p>"
            )
        },
        post_trial_gap: 500,
    }
    timeline_ebbinghaus.push(instructions_ebbinghaus)

    // Define trial
    var trial_ebbinghaus = create_trial("Ebbinghaus", type = "leftright")

    // Create Trials timeline
    timeline_ebbinghaus.push({
        timeline: [fixation, trial_ebbinghaus],
        timeline_variables: stimuli_ebbinghaus,
        randomize_order: true,
        repetitions: 1,
    })

    // Debriefing Information
    timeline_ebbinghaus.push(create_debrief(illusion_name = "Ebbinghaus"))

    // timeline.push({ timeline: timeline_ebbinghaus })

    /* ================================================================ */
    /* ------------------------ PONZO ILLUSION ------------------------ */
    /* ================================================================ */
    var timeline_ponzo = []

    // Set stimuli (var stimuli is loaded in stimuli/stimuli.js)
    var stimuli_ponzo = stimuli.filter(
        (stimuli) => stimuli.Illusion_Type === "Ponzo"
    )

    // Preload images
    timeline_ponzo.push({
        type: jsPsychPreload,
        trials: stimuli_ponzo,
    })

    // Instructions
    var instructions_ponzo = {
        type: jsPsychHtmlKeyboardResponse,
        on_start: function () {
            ;(document.body.style.cursor = "none"),
                (document.querySelector(
                    "#jspsych-progressbar-container"
                ).style.display = "none")
        },
        choices: ["enter"],
        stimulus: function () {
            return (
                "<p><b>Part " +
                block_number +
                "</b></p>" +
                "<p>In this part, two horizontal red lines will appear one above the other.</p>" +
                "<p>Your task is to select which <b>line is longer</b> in size as fast as you can, without making errors.</p>" +
                "<p>Don't get distracted by the surrounding black lines!</p>" +
                "<p>Press <b>the UP or the DOWN arrow</b> to indicate where is the longest <b>red line.</b></p>" +
                "<div style='float: center'><img src='utils/stimuli_demo/Ponzo_Demo.png' height='300'></img>" +
                "<p><img src='utils/answer/answer_updown_keyboard.PNG' height='150'></img></p>" +
                "<p class='small'>In this example, the correct answer is the <b>UP arrow</b>.</p></div>" +
                "<p>Are you ready? <b>Press ENTER to start</b></p>"
            )
        },
        post_trial_gap: 500,
    }
    timeline_ponzo.push(instructions_ponzo)

    // Define trial
    var trial_ponzo = create_trial("Ponzo", type = "updown")

    // Create Trials timeline
    timeline_ponzo.push({
        timeline: [fixation, trial_ponzo],
        timeline_variables: stimuli_ponzo,
        randomize_order: true,
        repetitions: 1,
    })

    // Debriefing Information
    timeline_ponzo.push(create_debrief(illusion_name = "Ponzo"))

    // timeline.push({ timeline: timeline_ponzo })




    /* ================================================================ */
    /* ----------------------- ZOLLNER ILLUSION ----------------------- */
    /* ================================================================ */
    var timeline_zollner = []

    // Set stimuli (var stimuli is loaded in stimuli/stimuli.js)
    var stimuli_zollner = stimuli.filter(
        (stimuli) => stimuli.Illusion_Type === "Zollner"
    )

    // Preload images
    timeline_zollner.push({
        type: jsPsychPreload,
        trials: stimuli_zollner,
    })

    // Instructions
    var instructions_zollner = {
        type: jsPsychHtmlKeyboardResponse,
        on_start: function () {
            ;(document.body.style.cursor = "none"),
                (document.querySelector(
                    "#jspsych-progressbar-container"
                ).style.display = "none")
        },
        choices: ["enter"],
        stimulus: function () {
            return (
                "<p><b>Part " +
                block_number +
                "</b></p>" +
                "<p>In this part, two horizontal red lines will appear one above the other.</p>" +
                "<p>Your task is to tell <b>the direction</b> towards which the red lines are converging, as fast as you can, and without making errors.</p>" +
                "<p>Don't get distracted by the black lines!</p>" +
                "<p>Press <b>the LEFT or the RIGHT arrow</b> to indicate the <b>direction where the red lines are pointing.</b></p>" +
                "<div style='float: center'><img src='utils/stimuli_demo/Zollner_Demo.png' height='300'></img>" +
                "<p><img src='utils/answer/answer_leftright_keyboard.PNG' height='150'></img></p>" +
                "<p class='small'>In this example, the correct answer is the <b>LEFT arrow</b>.</p></div>" +
                "<p>Are you ready? <b>Press ENTER to start</b></p>"
            )
        },
        post_trial_gap: 500,
    }
    timeline_zollner.push(instructions_zollner)

    // Define trial
    var trial_zollner = create_trial("Zollner", type = "leftright")

    // Create Trials timeline
    timeline_zollner.push({
        timeline: [fixation, trial_zollner],
        timeline_variables: stimuli_zollner,
        randomize_order: true,
        repetitions: 1,
    })

    // Debriefing Information
    timeline_zollner.push(create_debrief(illusion_name = "Zollner"))

    // timeline.push({ timeline: timeline_zollner })


    /* ================================================================ */
    /* ---------------------- CONTRAST ILLUSION ----------------------- */
    /* ================================================================ */
    var timeline_contrast = []

    // Set stimuli (var stimuli is loaded in stimuli/stimuli.js)
    var stimuli_contrast = stimuli.filter(
        (stimuli) => stimuli.Illusion_Type === "Contrast"
    )

    // Preload images
    timeline_contrast.push({
        type: jsPsychPreload,
        trials: stimuli_contrast,
    })

    // Instructions
    var instructions_contrast = {
        type: jsPsychHtmlKeyboardResponse,
        on_start: function () {
            ;(document.body.style.cursor = "none"),
                (document.querySelector(
                    "#jspsych-progressbar-container"
                ).style.display = "none")
        },
        choices: ["enter"],
        stimulus: function () {
            return (
                "<p><b>Part " +
                block_number +
                "</b></p>" +
                "<p>In this part, two small grey rectangles will appear one above the other.</p>" +
                "<p>Your task is to select which rectangle is <b>lighter</b> as fast as you can, without making errors.</p>" +
                "<p>Don't get distracted by the surrounding background!</p>" +
                "<p>Press <b>the UP or the DOWN arrow</b> to indicate where is the <b>lighter rectangle.</b></p>" +
                "<div style='float: center'><img src='utils/stimuli_demo/Contrast_Demo.png' height='300'></img>" +
                "<p><img src='utils/answer/answer_updown_keyboard.PNG' height='150'></img></p>" +
                "<p class='small'>In this example, the correct answer is the <b>UP arrow</b>.</p></div>" +
                "<p>Are you ready? <b>Press ENTER to start</b></p>"
            )
        },
        post_trial_gap: 500,
    }
    timeline_contrast.push(instructions_contrast)

    // Define trial
    var trial_contrast = create_trial("Contrast", type = "updown")

    // Create Trials timeline
    timeline_contrast.push({
        timeline: [fixation, trial_contrast],
        timeline_variables: stimuli_contrast,
        randomize_order: true,
        repetitions: 1,
    })

    // Debriefing Information
    timeline_contrast.push(create_debrief(illusion_name = "Contrast"))

    // timeline.push({ timeline: timeline_contrast })

    /* ================================================================ */
    /* ---------------------- RODFRAME ILLUSION ----------------------- */
    /* ================================================================ */
    var timeline_rodframe = []

    // Set stimuli (var stimuli is loaded in stimuli/stimuli.js)
    var stimuli_rodframe = stimuli.filter(
        (stimuli) => stimuli.Illusion_Type === "RodFrame"
    )

    // Preload images
    timeline_rodframe.push({
        type: jsPsychPreload,
        trials: stimuli_rodframe,
    })

    // Instructions
    var instructions_rodframe = {
        type: jsPsychHtmlKeyboardResponse,
        on_start: function () {
            ;(document.body.style.cursor = "none"),
                (document.querySelector(
                    "#jspsych-progressbar-container"
                ).style.display = "none")
        },
        choices: ["enter"],
        stimulus: function () {
            return (
                "<p><b>Part " +
                block_number +
                "</b></p>" +
                "<p>In this part, one vertical red line will appear in a square.</p>" +
                "<p>Your task is to tell <b>which direction</b> is the red line leaning, as fast as you can, and without making errors.</p>" +
                "<p>Don't get distracted by the black square!</p>" +
                "<p>Press <b>the LEFT or the RIGHT arrow</b> to indicate the <b>direction where the red line is leaning.</b></p>" +
                "<div style='float: center'><img src='utils/stimuli_demo/RodFrame_Demo.png' height='300'></img>" +
                "<p><img src='utils/answer/answer_leftright_keyboard.PNG' height='150'></img></p>" +
                "<p class='small'>In this example, the correct answer is the <b>LEFT arrow</b>.</p></div>" +
                "<p>Are you ready? <b>Press ENTER to start</b></p>"
            )
        },
        post_trial_gap: 500,
    }
    timeline_rodframe.push(instructions_rodframe)

    // Define trial
    var trial_rodframe = create_trial("RodFrame", type = "leftright")

    // Create Trials timeline
    timeline_rodframe.push({
        timeline: [fixation, trial_rodframe],
        timeline_variables: stimuli_rodframe,
        randomize_order: true,
        repetitions: 1,
    })

    // Debriefing Information
    timeline_rodframe.push(create_debrief(illusion_name = "RodFrame"))

    // timeline.push({ timeline: timeline_rodframe })

    /* ================================================================ */
    /* --------------------- POGGENDORFF ILLUSION --------------------- */
    /* ================================================================ */
    var timeline_poggendorff = []

    // Set stimuli (var stimuli is loaded in stimuli/stimuli.js)
    var stimuli_poggendorff = stimuli.filter(
        (stimuli) => stimuli.Illusion_Type === "Poggendorff"
    )

    // Preload images
    timeline_poggendorff.push({
        type: jsPsychPreload,
        trials: stimuli_poggendorff,
    })

    // Instructions
    var instructions_poggendorff = {
        type: jsPsychHtmlKeyboardResponse,
        on_start: function () {
            ;(document.body.style.cursor = "none"),
                (document.querySelector(
                    "#jspsych-progressbar-container"
                ).style.display = "none")
        },
        choices: ["enter"],
        stimulus: function () {
            return (
                "<p><b>Part " +
                block_number +
                "</b></p>" +
                "<p>In this part, two red lines will appear, one above the other, but their overlapping section is hidden behind a grey rectangle.</p>" +
                "<p>Your task is to tell if the <b>right</b> red line, <b>behind the rectangle, is above or below</b> the left line. You need to answer as fast as you can, without making errors.</p>" +
                "<p>Press <b>the UP or the DOWN arrow</b> to indicate whether the <b>right red line is actually above or below the left red line.</b></p>" +
                "<div style='float: center'><img src='utils/stimuli_demo/Poggendorff_Demo.png' height='300'></img>" +
                "<p><img src='utils/answer/answer_updown_keyboard.PNG' height='150'></img></p>" +
                "<p class='small'>In this example, the correct answer is the <b>UP arrow</b>.</p></div>" +
                "<p>Are you ready? <b>Press ENTER to start</b></p>"
            )
        },
        post_trial_gap: 500,
    }
    timeline_poggendorff.push(instructions_poggendorff)

    // Define trial
    var trial_poggendorff = create_trial("Poggendorff", type = "updown")

    // Create Trials timeline
    timeline_poggendorff.push({
        timeline: [fixation, trial_poggendorff],
        timeline_variables: stimuli_poggendorff,
        randomize_order: true,
        repetitions: 1,
    })

    // Debriefing Information
    timeline_poggendorff.push(create_debrief(illusion_name = "Poggendorff"))

    // timeline.push({ timeline: timeline_poggendorff })


    /* ================================================================ */
    /* ----------------- VERTICAL-HORIZONTAL ILLUSION ----------------- */
    /* ================================================================ */
    var timeline_verticalhorizontal = []

    // Set stimuli (var stimuli is loaded in stimuli/stimuli.js)
    var stimuli_verticalhorizontal = stimuli.filter(
        (stimuli) => stimuli.Illusion_Type === "VerticalHorizontal"
    )

    // Preload images
    timeline_verticalhorizontal.push({
        type: jsPsychPreload,
        trials: stimuli_verticalhorizontal,
    })

    // Instructions
    var instructions_verticalhorizontal = {
        type: jsPsychHtmlKeyboardResponse,
        on_start: function () {
            ;(document.body.style.cursor = "none"),
                (document.querySelector(
                    "#jspsych-progressbar-container"
                ).style.display = "none")
        },
        choices: ["enter"],
        stimulus: function () {
            return (
                "<p><b>Part " +
                block_number +
                "</b></p>" +
                "<p>In this part, two red lines will appear side by side.</p>" +
                "<p>Your task is to tell <b>which line is the longer</b> as fast as you can, and without making errors.</p>" +
                "<p>Don't get distracted by the orientation of the lines!</p>" +
                "<p>Press <b>the LEFT or the RIGHT arrow</b> to indicate which <b>line is the longer one.</b></p>" +
                "<div style='float: center'><img src='utils/stimuli_demo/VerticalHorizontal_Demo.png' height='300'></img>" +
                "<p><img src='utils/answer/answer_leftright_keyboard.PNG' height='150'></img></p>" +
                "<p class='small'>In this example, the correct answer is the <b>LEFT arrow</b>.</p></div>" +
                "<p>Are you ready? <b>Press ENTER to start</b></p>"
            )
        },
        post_trial_gap: 500,
    }
    timeline_verticalhorizontal.push(instructions_verticalhorizontal)

    // Define trial
    var trial_verticalhorizontal = create_trial("VerticalHorizontal", type = "leftright")

    // Create Trials timeline
    timeline_verticalhorizontal.push({
        timeline: [fixation, trial_verticalhorizontal],
        timeline_variables: stimuli_verticalhorizontal,
        randomize_order: true,
        repetitions: 1,
    })

    // Debriefing Information
    timeline_verticalhorizontal.push(create_debrief(illusion_name = "VerticalHorizontal"))

    // timeline.push({ timeline: timeline_verticalhorizontal })


    /* ================================================================ */
    /* ------------------------- WHITE ILLUSION ----------------------- */
    /* ================================================================ */
    var timeline_white = []

    // Set stimuli (var stimuli is loaded in stimuli/stimuli.js)
    var stimuli_white = stimuli.filter(
        (stimuli) => stimuli.Illusion_Type === "White"
    )

    // Preload images
    timeline_white.push({
        type: jsPsychPreload,
        trials: stimuli_white,
    })

    // Instructions
    var instructions_white = {
        type: jsPsychHtmlKeyboardResponse,
        on_start: function () {
            ;(document.body.style.cursor = "none"),
                (document.querySelector(
                    "#jspsych-progressbar-container"
                ).style.display = "none")
        },
        choices: ["enter"],
        stimulus: function () {
            return (
                "<p><b>Part " +
                block_number +
                "</b></p>" +
                "<p>In this part, two vertical grey rectangles will appear side by side.</p>" +
                "<p>Your task is to tell <b>which rectangle is of a lighter color</b>, as fast as you can, and without making errors.</p>" +
                "<p>Don't get distracted by the background color!</p>" +
                "<p>Press <b>the LEFT or the RIGHT arrow</b> to indicate which <b>side has the lighter rectangle.</b></p>" +
                "<div style='float: center'><img src='utils/stimuli_demo/White_Demo.png' height='300'></img>" +
                "<p><img src='utils/answer/answer_leftright_keyboard.PNG' height='150'></img></p>" +
                "<p class='small'>In this example, the correct answer is the <b>LEFT arrow</b>.</p></div>" +
                "<p>Are you ready? <b>Press ENTER to start</b></p>"
            )
        },
        post_trial_gap: 500,
    }
    timeline_white.push(instructions_white)

    // Define trial
    var trial_white = create_trial("White", type = "leftright")

    // Create Trials timeline
    timeline_white.push({
        timeline: [fixation, trial_white],
        timeline_variables: stimuli_white,
        randomize_order: true,
        repetitions: 1,
    })

    // Debriefing Information
    timeline_white.push(create_debrief(illusion_name = "White"))

    // timeline.push({ timeline: timeline_white })


    /* ================================================================ */
    /* ---------------------- END OF EXPERIMENT ----------------------- */
    /* ================================================================ */
    for (var i of [1, 2]) {
        for (var t of jsPsych.randomization.shuffleNoRepeats([
            timeline_delboeuf,
            timeline_mullerlyer,
            timeline_ebbinghaus,
            timeline_ponzo,
            timeline_zollner,
            timeline_contrast,
            timeline_rodframe,
            timeline_poggendorff,
            timeline_verticalhorizontal,
            timeline_white,
        ])) {
            timeline.push({ timeline: t })
        }
    }



    // Debriefing Information
    var end_experiment = {
        type: jsPsychHtmlButtonResponse,
        choices: ["End"],
        stimulus: function () {
            var results = get_results(
                population_scores["Total"]["IES_Mean"][0],
                population_scores["Total"]["IES_SD"][0]
            )
            var show_screen = get_debrief_display(results, "Final")
            return (
                show_screen.display_score +
                "<hr>" +
                show_screen.display_comparison +
                "<hr><p>Wait for the experimenter to end the session.</p>"
            )
        },
        data: { screen: "final_results" },
    }
    timeline.push(end_experiment)

    // Fullscreen mode
    timeline.push({
        type: jsPsychFullscreen,
        fullscreen_mode: false,
    })

    jsPsych.run(timeline)




</script>

</html>

